package com.example.weatherapp

import Alert
import CurrentWeather
import DailyWeather
import FeelsLike
import HourlyWeather
import MinutelyWeather
import Temperature
import WeatherApiResponse
import WeatherCondition
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.async
import kotlinx.coroutines.withContext
import org.json.JSONArray
import org.json.JSONObject
import java.net.URL

class WeatherApiClient(private val apiKey: String) {
    suspend fun getWeatherData(latitude: Double, longitude: Double): WeatherApiResponse = withContext(
        Dispatchers.IO) {
        val url = "https://api.openweathermap.org/data/3.0/onecall?lat=$latitude&lon=$longitude&units=metric&exclude=minutely&appid=$apiKey"

        val json = withContext(Dispatchers.IO) {
            getJsonData(url)
        }

//        val json = JSONObject("{\"lat\":52.4,\"lon\":16.9,\"timezone\":\"Europe/Warsaw\",\"timezone_offset\":7200,\"current\":{\"dt\":1688038226,\"sunrise\":1688005969,\"sunset\":1688066309,\"temp\":24.14,\"feels_like\":23.86,\"pressure\":1015,\"humidity\":48,\"dew_point\":12.45,\"uvi\":6.66,\"clouds\":0,\"visibility\":10000,\"wind_speed\":4.63,\"wind_deg\":290,\"weather\":[{\"id\":800,\"main\":\"Clear\",\"description\":\"clear sky\",\"icon\":\"01d\"}]},\"hourly\":[{\"dt\":1688036400,\"temp\":24.13,\"feels_like\":23.83,\"pressure\":1015,\"humidity\":47,\"dew_point\":12.12,\"uvi\":7.12,\"clouds\":11,\"visibility\":10000,\"wind_speed\":3.46,\"wind_deg\":280,\"wind_gust\":3.93,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02d\"}],\"pop\":0},{\"dt\":1688040000,\"temp\":24.14,\"feels_like\":23.86,\"pressure\":1015,\"humidity\":48,\"dew_point\":12.45,\"uvi\":6.66,\"clouds\":0,\"visibility\":10000,\"wind_speed\":3.41,\"wind_deg\":279,\"wind_gust\":4.01,\"weather\":[{\"id\":800,\"main\":\"Clear\",\"description\":\"clear sky\",\"icon\":\"01d\"}],\"pop\":0},{\"dt\":1688043600,\"temp\":24.36,\"feels_like\":24.05,\"pressure\":1015,\"humidity\":46,\"dew_point\":12.01,\"uvi\":5.57,\"clouds\":1,\"visibility\":10000,\"wind_speed\":3.18,\"wind_deg\":278,\"wind_gust\":4.2,\"weather\":[{\"id\":800,\"main\":\"Clear\",\"description\":\"clear sky\",\"icon\":\"01d\"}],\"pop\":0},{\"dt\":1688047200,\"temp\":24.74,\"feels_like\":24.42,\"pressure\":1014,\"humidity\":44,\"dew_point\":11.68,\"uvi\":4.09,\"clouds\":3,\"visibility\":10000,\"wind_speed\":2.89,\"wind_deg\":278,\"wind_gust\":4.22,\"weather\":[{\"id\":800,\"main\":\"Clear\",\"description\":\"clear sky\",\"icon\":\"01d\"}],\"pop\":0},{\"dt\":1688050800,\"temp\":25.12,\"feels_like\":24.76,\"pressure\":1013,\"humidity\":41,\"dew_point\":10.95,\"uvi\":2.58,\"clouds\":8,\"visibility\":10000,\"wind_speed\":2.74,\"wind_deg\":275,\"wind_gust\":4.13,\"weather\":[{\"id\":800,\"main\":\"Clear\",\"description\":\"clear sky\",\"icon\":\"01d\"}],\"pop\":0},{\"dt\":1688054400,\"temp\":24.89,\"feels_like\":24.53,\"pressure\":1013,\"humidity\":42,\"dew_point\":11.11,\"uvi\":0.87,\"clouds\":21,\"visibility\":10000,\"wind_speed\":2.89,\"wind_deg\":259,\"wind_gust\":3.76,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02d\"}],\"pop\":0},{\"dt\":1688058000,\"temp\":22.63,\"feels_like\":22.31,\"pressure\":1012,\"humidity\":52,\"dew_point\":12.21,\"uvi\":0.38,\"clouds\":41,\"visibility\":10000,\"wind_speed\":2.51,\"wind_deg\":270,\"wind_gust\":3.82,\"weather\":[{\"id\":802,\"main\":\"Clouds\",\"description\":\"scattered clouds\",\"icon\":\"03d\"}],\"pop\":0},{\"dt\":1688061600,\"temp\":21.22,\"feels_like\":20.89,\"pressure\":1012,\"humidity\":57,\"dew_point\":12.34,\"uvi\":0.12,\"clouds\":51,\"visibility\":10000,\"wind_speed\":2.44,\"wind_deg\":321,\"wind_gust\":3.12,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04d\"}],\"pop\":0},{\"dt\":1688065200,\"temp\":20.55,\"feels_like\":20.12,\"pressure\":1012,\"humidity\":56,\"dew_point\":11.6,\"uvi\":0,\"clouds\":100,\"visibility\":10000,\"wind_speed\":1.53,\"wind_deg\":1,\"wind_gust\":1.71,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04d\"}],\"pop\":0},{\"dt\":1688068800,\"temp\":20,\"feels_like\":19.52,\"pressure\":1012,\"humidity\":56,\"dew_point\":11,\"uvi\":0,\"clouds\":97,\"visibility\":10000,\"wind_speed\":1.35,\"wind_deg\":54,\"wind_gust\":1.32,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04n\"}],\"pop\":0},{\"dt\":1688072400,\"temp\":19.55,\"feels_like\":19.08,\"pressure\":1012,\"humidity\":58,\"dew_point\":11.21,\"uvi\":0,\"clouds\":98,\"visibility\":10000,\"wind_speed\":1.52,\"wind_deg\":81,\"wind_gust\":1.52,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04n\"}],\"pop\":0},{\"dt\":1688076000,\"temp\":19.38,\"feels_like\":18.94,\"pressure\":1012,\"humidity\":60,\"dew_point\":11.4,\"uvi\":0,\"clouds\":99,\"visibility\":10000,\"wind_speed\":1.33,\"wind_deg\":98,\"wind_gust\":1.4,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04n\"}],\"pop\":0},{\"dt\":1688079600,\"temp\":19.22,\"feels_like\":18.76,\"pressure\":1012,\"humidity\":60,\"dew_point\":11.31,\"uvi\":0,\"clouds\":99,\"visibility\":10000,\"wind_speed\":1.04,\"wind_deg\":147,\"wind_gust\":1.03,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04n\"}],\"pop\":0},{\"dt\":1688083200,\"temp\":18.99,\"feels_like\":18.54,\"pressure\":1011,\"humidity\":61,\"dew_point\":11.14,\"uvi\":0,\"clouds\":99,\"visibility\":10000,\"wind_speed\":1.37,\"wind_deg\":157,\"wind_gust\":1.4,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04n\"}],\"pop\":0},{\"dt\":1688086800,\"temp\":18.72,\"feels_like\":18.24,\"pressure\":1011,\"humidity\":61,\"dew_point\":11.14,\"uvi\":0,\"clouds\":97,\"visibility\":10000,\"wind_speed\":1.2,\"wind_deg\":189,\"wind_gust\":1.32,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04n\"}],\"pop\":0},{\"dt\":1688090400,\"temp\":18.02,\"feels_like\":17.52,\"pressure\":1011,\"humidity\":63,\"dew_point\":11.04,\"uvi\":0,\"clouds\":88,\"visibility\":10000,\"wind_speed\":1.74,\"wind_deg\":245,\"wind_gust\":1.7,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04n\"}],\"pop\":0},{\"dt\":1688094000,\"temp\":16.49,\"feels_like\":16.05,\"pressure\":1010,\"humidity\":71,\"dew_point\":11.34,\"uvi\":0,\"clouds\":92,\"visibility\":10000,\"wind_speed\":1.69,\"wind_deg\":249,\"wind_gust\":1.72,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04d\"}],\"pop\":0},{\"dt\":1688097600,\"temp\":17.27,\"feels_like\":16.96,\"pressure\":1010,\"humidity\":73,\"dew_point\":12.34,\"uvi\":0.21,\"clouds\":94,\"visibility\":10000,\"wind_speed\":2.31,\"wind_deg\":251,\"wind_gust\":3.1,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04d\"}],\"pop\":0},{\"dt\":1688101200,\"temp\":19.42,\"feels_like\":19.17,\"pressure\":1010,\"humidity\":67,\"dew_point\":13.04,\"uvi\":0.63,\"clouds\":85,\"visibility\":10000,\"wind_speed\":2.17,\"wind_deg\":248,\"wind_gust\":3.21,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04d\"}],\"pop\":0},{\"dt\":1688104800,\"temp\":21.24,\"feels_like\":21.01,\"pressure\":1010,\"humidity\":61,\"dew_point\":13.4,\"uvi\":1.41,\"clouds\":84,\"visibility\":10000,\"wind_speed\":2.59,\"wind_deg\":255,\"wind_gust\":3.63,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04d\"}],\"pop\":0},{\"dt\":1688108400,\"temp\":22.95,\"feels_like\":22.76,\"pressure\":1010,\"humidity\":56,\"dew_point\":13.64,\"uvi\":0.96,\"clouds\":73,\"visibility\":10000,\"wind_speed\":2.55,\"wind_deg\":257,\"wind_gust\":3.41,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04d\"}],\"pop\":0},{\"dt\":1688112000,\"temp\":24.12,\"feels_like\":23.95,\"pressure\":1010,\"humidity\":52,\"dew_point\":13.74,\"uvi\":1.46,\"clouds\":83,\"visibility\":10000,\"wind_speed\":2.76,\"wind_deg\":262,\"wind_gust\":3.21,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04d\"}],\"pop\":0},{\"dt\":1688115600,\"temp\":24.79,\"feels_like\":24.66,\"pressure\":1010,\"humidity\":51,\"dew_point\":13.94,\"uvi\":1.95,\"clouds\":80,\"visibility\":10000,\"wind_speed\":4.29,\"wind_deg\":262,\"wind_gust\":4.3,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04d\"}],\"pop\":0},{\"dt\":1688119200,\"temp\":22.89,\"feels_like\":22.75,\"pressure\":1010,\"humidity\":58,\"dew_point\":14.24,\"uvi\":3.89,\"clouds\":85,\"visibility\":10000,\"wind_speed\":4.24,\"wind_deg\":276,\"wind_gust\":4.02,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04d\"}],\"pop\":0},{\"dt\":1688122800,\"temp\":24.67,\"feels_like\":24.58,\"pressure\":1009,\"humidity\":53,\"dew_point\":14.54,\"uvi\":4.07,\"clouds\":81,\"visibility\":10000,\"wind_speed\":2.95,\"wind_deg\":278,\"wind_gust\":3.53,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04d\"}],\"pop\":0},{\"dt\":1688126400,\"temp\":24.07,\"feels_like\":24.02,\"pressure\":1009,\"humidity\":57,\"dew_point\":15.04,\"uvi\":3.8,\"clouds\":84,\"visibility\":10000,\"wind_speed\":3.71,\"wind_deg\":270,\"wind_gust\":4.52,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04d\"}],\"pop\":0},{\"dt\":1688130000,\"temp\":21.97,\"feels_like\":21.95,\"pressure\":1009,\"humidity\":66,\"dew_point\":15.5,\"uvi\":1.98,\"clouds\":100,\"visibility\":10000,\"wind_speed\":3.83,\"wind_deg\":266,\"wind_gust\":4.73,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04d\"}],\"pop\":0.4},{\"dt\":1688133600,\"temp\":21.52,\"feels_like\":21.53,\"pressure\":1008,\"humidity\":69,\"dew_point\":15.74,\"uvi\":1.46,\"clouds\":100,\"visibility\":10000,\"wind_speed\":4.81,\"wind_deg\":270,\"wind_gust\":6.64,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"pop\":0.6,\"rain\":{\"1h\":0.19}},{\"dt\":1688137200,\"temp\":18.92,\"feels_like\":19.17,\"pressure\":1009,\"humidity\":88,\"dew_point\":16.94,\"uvi\":0.92,\"clouds\":100,\"visibility\":5319,\"wind_speed\":5.61,\"wind_deg\":269,\"wind_gust\":8.62,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"pop\":0.84,\"rain\":{\"1h\":0.94}},{\"dt\":1688140800,\"temp\":17.76,\"feels_like\":18.1,\"pressure\":1009,\"humidity\":96,\"dew_point\":17.24,\"uvi\":0.2,\"clouds\":100,\"visibility\":10000,\"wind_speed\":4.41,\"wind_deg\":292,\"wind_gust\":9.33,\"weather\":[{\"id\":501,\"main\":\"Rain\",\"description\":\"moderate rain\",\"icon\":\"10d\"}],\"pop\":1,\"rain\":{\"1h\":3.56}},{\"dt\":1688144400,\"temp\":17.49,\"feels_like\":17.8,\"pressure\":1009,\"humidity\":96,\"dew_point\":16.94,\"uvi\":0.09,\"clouds\":100,\"visibility\":10000,\"wind_speed\":3.24,\"wind_deg\":312,\"wind_gust\":7.02,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"pop\":1,\"rain\":{\"1h\":0.63}},{\"dt\":1688148000,\"temp\":17.26,\"feels_like\":17.57,\"pressure\":1009,\"humidity\":97,\"dew_point\":16.74,\"uvi\":0.03,\"clouds\":100,\"visibility\":10000,\"wind_speed\":2.16,\"wind_deg\":285,\"wind_gust\":4.9,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"pop\":1,\"rain\":{\"1h\":0.38}},{\"dt\":1688151600,\"temp\":17.12,\"feels_like\":17.39,\"pressure\":1009,\"humidity\":96,\"dew_point\":16.54,\"uvi\":0,\"clouds\":100,\"visibility\":10000,\"wind_speed\":2.24,\"wind_deg\":268,\"wind_gust\":4.3,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04d\"}],\"pop\":0.12},{\"dt\":1688155200,\"temp\":16.52,\"feels_like\":16.76,\"pressure\":1009,\"humidity\":97,\"dew_point\":16.14,\"uvi\":0,\"clouds\":100,\"visibility\":10000,\"wind_speed\":2.52,\"wind_deg\":276,\"wind_gust\":3.73,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04n\"}],\"pop\":0.12},{\"dt\":1688158800,\"temp\":16.52,\"feels_like\":16.79,\"pressure\":1009,\"humidity\":98,\"dew_point\":16.14,\"uvi\":0,\"clouds\":100,\"visibility\":10000,\"wind_speed\":1.88,\"wind_deg\":286,\"wind_gust\":2.91,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04n\"}],\"pop\":0.24},{\"dt\":1688162400,\"temp\":16.66,\"feels_like\":16.91,\"pressure\":1009,\"humidity\":97,\"dew_point\":16.24,\"uvi\":0,\"clouds\":100,\"visibility\":10000,\"wind_speed\":1.62,\"wind_deg\":310,\"wind_gust\":2.81,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04n\"}],\"pop\":0.12},{\"dt\":1688166000,\"temp\":16.69,\"feels_like\":16.92,\"pressure\":1009,\"humidity\":96,\"dew_point\":16.01,\"uvi\":0,\"clouds\":100,\"visibility\":8203,\"wind_speed\":1.56,\"wind_deg\":334,\"wind_gust\":2.61,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10n\"}],\"pop\":0.28,\"rain\":{\"1h\":0.38}},{\"dt\":1688169600,\"temp\":16.42,\"feels_like\":16.62,\"pressure\":1009,\"humidity\":96,\"dew_point\":15.84,\"uvi\":0,\"clouds\":100,\"visibility\":10000,\"wind_speed\":1.76,\"wind_deg\":317,\"wind_gust\":2.62,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10n\"}],\"pop\":0.4,\"rain\":{\"1h\":0.5}},{\"dt\":1688173200,\"temp\":16.02,\"feels_like\":16.21,\"pressure\":1009,\"humidity\":97,\"dew_point\":15.44,\"uvi\":0,\"clouds\":100,\"visibility\":10000,\"wind_speed\":2.09,\"wind_deg\":315,\"wind_gust\":3.7,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10n\"}],\"pop\":0.6,\"rain\":{\"1h\":0.63}},{\"dt\":1688176800,\"temp\":15.99,\"feels_like\":16.15,\"pressure\":1008,\"humidity\":96,\"dew_point\":15.34,\"uvi\":0,\"clouds\":100,\"visibility\":10000,\"wind_speed\":1.92,\"wind_deg\":287,\"wind_gust\":3.8,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10n\"}],\"pop\":0.84,\"rain\":{\"1h\":0.19}},{\"dt\":1688180400,\"temp\":15.87,\"feels_like\":16.05,\"pressure\":1008,\"humidity\":97,\"dew_point\":15.34,\"uvi\":0,\"clouds\":100,\"visibility\":10000,\"wind_speed\":2.31,\"wind_deg\":275,\"wind_gust\":4.9,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"pop\":0.8,\"rain\":{\"1h\":0.5}},{\"dt\":1688184000,\"temp\":15.69,\"feels_like\":15.82,\"pressure\":1008,\"humidity\":96,\"dew_point\":15,\"uvi\":0.21,\"clouds\":91,\"visibility\":10000,\"wind_speed\":2.84,\"wind_deg\":275,\"wind_gust\":5.32,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"pop\":0.72,\"rain\":{\"1h\":0.25}},{\"dt\":1688187600,\"temp\":15.94,\"feels_like\":16.02,\"pressure\":1008,\"humidity\":93,\"dew_point\":14.84,\"uvi\":0.61,\"clouds\":92,\"visibility\":10000,\"wind_speed\":3.02,\"wind_deg\":272,\"wind_gust\":4.7,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04d\"}],\"pop\":0.76},{\"dt\":1688191200,\"temp\":17.08,\"feels_like\":17.04,\"pressure\":1008,\"humidity\":84,\"dew_point\":14.44,\"uvi\":1.37,\"clouds\":94,\"visibility\":10000,\"wind_speed\":3.88,\"wind_deg\":261,\"wind_gust\":4.7,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"pop\":0.72,\"rain\":{\"1h\":0.13}},{\"dt\":1688194800,\"temp\":18.04,\"feels_like\":17.94,\"pressure\":1008,\"humidity\":78,\"dew_point\":14.14,\"uvi\":2.62,\"clouds\":100,\"visibility\":10000,\"wind_speed\":4.2,\"wind_deg\":256,\"wind_gust\":5.01,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04d\"}],\"pop\":0.4},{\"dt\":1688198400,\"temp\":19.24,\"feels_like\":19,\"pressure\":1008,\"humidity\":68,\"dew_point\":13.3,\"uvi\":3.99,\"clouds\":100,\"visibility\":10000,\"wind_speed\":4.41,\"wind_deg\":256,\"wind_gust\":5.02,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04d\"}],\"pop\":0.4},{\"dt\":1688202000,\"temp\":20.64,\"feels_like\":20.25,\"pressure\":1007,\"humidity\":57,\"dew_point\":11.8,\"uvi\":5.31,\"clouds\":98,\"visibility\":10000,\"wind_speed\":4.5,\"wind_deg\":258,\"wind_gust\":5.2,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04d\"}],\"pop\":0.32},{\"dt\":1688205600,\"temp\":21.72,\"feels_like\":21.23,\"pressure\":1007,\"humidity\":49,\"dew_point\":10.64,\"uvi\":6.47,\"clouds\":95,\"visibility\":10000,\"wind_speed\":4.45,\"wind_deg\":254,\"wind_gust\":5.3,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04d\"}],\"pop\":0.32}],\"daily\":[{\"dt\":1688032800,\"sunrise\":1688005969,\"sunset\":1688066309,\"moonrise\":1688050620,\"moonset\":1687994760,\"moon_phase\":0.35,\"summary\":\"Expect a day of partly cloudy with clear spells\",\"temp\":{\"day\":23.76,\"min\":12.12,\"max\":25.12,\"night\":19.55,\"eve\":24.89,\"morn\":13.05},\"feels_like\":{\"day\":23.44,\"night\":19.08,\"eve\":24.53,\"morn\":12.79},\"pressure\":1015,\"humidity\":48,\"dew_point\":12.11,\"wind_speed\":3.5,\"wind_deg\":310,\"wind_gust\":8.31,\"weather\":[{\"id\":802,\"main\":\"Clouds\",\"description\":\"scattered clouds\",\"icon\":\"03d\"}],\"clouds\":28,\"pop\":0.08,\"uvi\":7.12},{\"dt\":1688119200,\"sunrise\":1688092405,\"sunset\":1688152695,\"moonrise\":1688142240,\"moonset\":1688082180,\"moon_phase\":0.39,\"summary\":\"Expect a day of partly cloudy with rain\",\"temp\":{\"day\":22.89,\"min\":16.49,\"max\":24.79,\"night\":16.52,\"eve\":17.76,\"morn\":17.27},\"feels_like\":{\"day\":22.75,\"night\":16.79,\"eve\":18.1,\"morn\":16.96},\"pressure\":1010,\"humidity\":58,\"dew_point\":14.24,\"wind_speed\":5.61,\"wind_deg\":269,\"wind_gust\":9.33,\"weather\":[{\"id\":501,\"main\":\"Rain\",\"description\":\"moderate rain\",\"icon\":\"10d\"}],\"clouds\":85,\"pop\":1,\"rain\":5.7,\"uvi\":4.07},{\"dt\":1688205600,\"sunrise\":1688178844,\"sunset\":1688239079,\"moonrise\":1688233860,\"moonset\":1688169960,\"moon_phase\":0.42,\"summary\":\"Expect a day of partly cloudy with rain\",\"temp\":{\"day\":21.72,\"min\":15.69,\"max\":24,\"night\":17.87,\"eve\":21.55,\"morn\":15.69},\"feels_like\":{\"day\":21.23,\"night\":17.36,\"eve\":21.12,\"morn\":15.82},\"pressure\":1007,\"humidity\":49,\"dew_point\":10.64,\"wind_speed\":6.15,\"wind_deg\":253,\"wind_gust\":10.1,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"clouds\":95,\"pop\":0.84,\"rain\":2.58,\"uvi\":6.77},{\"dt\":1688292000,\"sunrise\":1688265286,\"sunset\":1688325458,\"moonrise\":1688324940,\"moonset\":1688258520,\"moon_phase\":0.46,\"summary\":\"Expect a day of partly cloudy with rain\",\"temp\":{\"day\":19.56,\"min\":14.22,\"max\":21.17,\"night\":15.42,\"eve\":20.39,\"morn\":14.68},\"feels_like\":{\"day\":18.9,\"night\":14.32,\"eve\":19.89,\"morn\":14.58},\"pressure\":1006,\"humidity\":51,\"dew_point\":9.02,\"wind_speed\":8.81,\"wind_deg\":257,\"wind_gust\":13.11,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"clouds\":30,\"pop\":0.76,\"rain\":0.82,\"uvi\":5.83},{\"dt\":1688378400,\"sunrise\":1688351731,\"sunset\":1688411835,\"moonrise\":1688415000,\"moonset\":1688348280,\"moon_phase\":0.5,\"summary\":\"Expect a day of partly cloudy with clear spells\",\"temp\":{\"day\":19.69,\"min\":10.58,\"max\":24.27,\"night\":15.8,\"eve\":24.27,\"morn\":10.58},\"feels_like\":{\"day\":18.79,\"night\":15.08,\"eve\":23.64,\"morn\":9.78},\"pressure\":1013,\"humidity\":41,\"dew_point\":6.24,\"wind_speed\":6.82,\"wind_deg\":247,\"wind_gust\":10.2,\"weather\":[{\"id\":800,\"main\":\"Clear\",\"description\":\"clear sky\",\"icon\":\"01d\"}],\"clouds\":1,\"pop\":0,\"uvi\":6.74},{\"dt\":1688464800,\"sunrise\":1688438178,\"sunset\":1688498209,\"moonrise\":1688503860,\"moonset\":1688439240,\"moon_phase\":0.54,\"summary\":\"There will be partly cloudy today\",\"temp\":{\"day\":22.32,\"min\":13.23,\"max\":25.82,\"night\":18.2,\"eve\":25.82,\"morn\":13.23},\"feels_like\":{\"day\":21.7,\"night\":17.64,\"eve\":25.37,\"morn\":12.46},\"pressure\":1015,\"humidity\":42,\"dew_point\":8.85,\"wind_speed\":4.85,\"wind_deg\":244,\"wind_gust\":6.9,\"weather\":[{\"id\":802,\"main\":\"Clouds\",\"description\":\"scattered clouds\",\"icon\":\"03d\"}],\"clouds\":28,\"pop\":0,\"uvi\":7},{\"dt\":1688551200,\"sunrise\":1688524628,\"sunset\":1688584579,\"moonrise\":1688591940,\"moonset\":1688531100,\"moon_phase\":0.58,\"summary\":\"You can expect partly cloudy in the morning, with rain in the afternoon\",\"temp\":{\"day\":27.65,\"min\":17.05,\"max\":30.95,\"night\":17.63,\"eve\":29.83,\"morn\":17.05},\"feels_like\":{\"day\":27.84,\"night\":17.88,\"eve\":28.91,\"morn\":16.59},\"pressure\":1013,\"humidity\":47,\"dew_point\":15.41,\"wind_speed\":7.01,\"wind_deg\":199,\"wind_gust\":13,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"clouds\":100,\"pop\":0.92,\"rain\":3.31,\"uvi\":7},{\"dt\":1688637600,\"sunrise\":1688611080,\"sunset\":1688670946,\"moonrise\":1688679480,\"moonset\":1688623200,\"moon_phase\":0.61,\"summary\":\"There will be rain until morning, then partly cloudy\",\"temp\":{\"day\":20.79,\"min\":11.61,\"max\":25.53,\"night\":18.51,\"eve\":25.53,\"morn\":11.61},\"feels_like\":{\"day\":20.1,\"night\":17.75,\"eve\":25,\"morn\":11.33},\"pressure\":1020,\"humidity\":45,\"dew_point\":8.41,\"wind_speed\":6.19,\"wind_deg\":291,\"wind_gust\":11.5,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04d\"}],\"clouds\":83,\"pop\":0.8,\"uvi\":7}]}")

//        val json = JSONObject("{\"lat\":40.8,\"lon\":-74,\"timezone\":\"America/New_York\",\"timezone_offset\":-14400,\"current\":{\"dt\":1688043682,\"sunrise\":1688030828,\"sunset\":1688085088,\"temp\":21.89,\"feels_like\":21.91,\"pressure\":1017,\"humidity\":68,\"dew_point\":15.72,\"uvi\":2.95,\"clouds\":20,\"visibility\":10000,\"wind_speed\":3.6,\"wind_deg\":360,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02d\"}]},\"hourly\":[{\"dt\":1688043600,\"temp\":21.89,\"feels_like\":21.91,\"pressure\":1017,\"humidity\":68,\"dew_point\":15.72,\"uvi\":2.95,\"clouds\":20,\"visibility\":10000,\"wind_speed\":3.43,\"wind_deg\":323,\"wind_gust\":5.03,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02d\"}],\"pop\":0},{\"dt\":1688047200,\"temp\":22.22,\"feels_like\":22.19,\"pressure\":1017,\"humidity\":65,\"dew_point\":15.33,\"uvi\":4.92,\"clouds\":17,\"visibility\":10000,\"wind_speed\":3.15,\"wind_deg\":325,\"wind_gust\":4.51,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02d\"}],\"pop\":0},{\"dt\":1688050800,\"temp\":23.22,\"feels_like\":23.16,\"pressure\":1017,\"humidity\":60,\"dew_point\":15.03,\"uvi\":6.89,\"clouds\":13,\"visibility\":10000,\"wind_speed\":2.75,\"wind_deg\":320,\"wind_gust\":4.03,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02d\"}],\"pop\":0},{\"dt\":1688054400,\"temp\":24.79,\"feels_like\":24.73,\"pressure\":1016,\"humidity\":54,\"dew_point\":14.86,\"uvi\":8.3,\"clouds\":13,\"visibility\":10000,\"wind_speed\":2.57,\"wind_deg\":313,\"wind_gust\":3.98,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02d\"}],\"pop\":0},{\"dt\":1688058000,\"temp\":26.75,\"feels_like\":26.98,\"pressure\":1015,\"humidity\":46,\"dew_point\":14.18,\"uvi\":8.76,\"clouds\":17,\"visibility\":10000,\"wind_speed\":2.41,\"wind_deg\":302,\"wind_gust\":3.76,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02d\"}],\"pop\":0},{\"dt\":1688061600,\"temp\":29.07,\"feels_like\":28.5,\"pressure\":1015,\"humidity\":38,\"dew_point\":13.4,\"uvi\":8.15,\"clouds\":21,\"visibility\":10000,\"wind_speed\":2.5,\"wind_deg\":295,\"wind_gust\":3.9,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02d\"}],\"pop\":0},{\"dt\":1688065200,\"temp\":29.77,\"feels_like\":28.93,\"pressure\":1015,\"humidity\":35,\"dew_point\":12.9,\"uvi\":6.68,\"clouds\":16,\"visibility\":10000,\"wind_speed\":2.62,\"wind_deg\":297,\"wind_gust\":3.66,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02d\"}],\"pop\":0},{\"dt\":1688068800,\"temp\":30.17,\"feels_like\":29.16,\"pressure\":1014,\"humidity\":33,\"dew_point\":12.18,\"uvi\":4.67,\"clouds\":11,\"visibility\":10000,\"wind_speed\":2.41,\"wind_deg\":297,\"wind_gust\":3.1,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02d\"}],\"pop\":0},{\"dt\":1688072400,\"temp\":30.09,\"feels_like\":29.08,\"pressure\":1014,\"humidity\":33,\"dew_point\":12.08,\"uvi\":2.72,\"clouds\":18,\"visibility\":10000,\"wind_speed\":1.63,\"wind_deg\":296,\"wind_gust\":2.53,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02d\"}],\"pop\":0},{\"dt\":1688076000,\"temp\":29.52,\"feels_like\":28.69,\"pressure\":1014,\"humidity\":35,\"dew_point\":12.52,\"uvi\":1.16,\"clouds\":14,\"visibility\":10000,\"wind_speed\":0.27,\"wind_deg\":310,\"wind_gust\":2.71,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02d\"}],\"pop\":0},{\"dt\":1688079600,\"temp\":28.16,\"feels_like\":27.95,\"pressure\":1015,\"humidity\":42,\"dew_point\":14.14,\"uvi\":0.38,\"clouds\":15,\"visibility\":10000,\"wind_speed\":2.38,\"wind_deg\":98,\"wind_gust\":2.86,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02d\"}],\"pop\":0},{\"dt\":1688083200,\"temp\":26,\"feels_like\":26,\"pressure\":1015,\"humidity\":52,\"dew_point\":15.36,\"uvi\":0,\"clouds\":19,\"visibility\":10000,\"wind_speed\":2.87,\"wind_deg\":117,\"wind_gust\":3.68,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02d\"}],\"pop\":0},{\"dt\":1688086800,\"temp\":24.94,\"feels_like\":24.95,\"pressure\":1016,\"humidity\":56,\"dew_point\":15.8,\"uvi\":0,\"clouds\":41,\"visibility\":10000,\"wind_speed\":2.63,\"wind_deg\":130,\"wind_gust\":3.68,\"weather\":[{\"id\":802,\"main\":\"Clouds\",\"description\":\"scattered clouds\",\"icon\":\"03n\"}],\"pop\":0},{\"dt\":1688090400,\"temp\":24.29,\"feels_like\":24.34,\"pressure\":1017,\"humidity\":60,\"dew_point\":16.02,\"uvi\":0,\"clouds\":27,\"visibility\":10000,\"wind_speed\":2.08,\"wind_deg\":153,\"wind_gust\":3.5,\"weather\":[{\"id\":802,\"main\":\"Clouds\",\"description\":\"scattered clouds\",\"icon\":\"03n\"}],\"pop\":0},{\"dt\":1688094000,\"temp\":23.56,\"feels_like\":23.64,\"pressure\":1017,\"humidity\":64,\"dew_point\":16.32,\"uvi\":0,\"clouds\":20,\"visibility\":10000,\"wind_speed\":1.69,\"wind_deg\":160,\"wind_gust\":3.16,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02n\"}],\"pop\":0},{\"dt\":1688097600,\"temp\":23.08,\"feels_like\":23.17,\"pressure\":1017,\"humidity\":66,\"dew_point\":16.48,\"uvi\":0,\"clouds\":16,\"visibility\":10000,\"wind_speed\":1.09,\"wind_deg\":171,\"wind_gust\":2.66,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02n\"}],\"pop\":0},{\"dt\":1688101200,\"temp\":22.66,\"feels_like\":22.76,\"pressure\":1017,\"humidity\":68,\"dew_point\":16.49,\"uvi\":0,\"clouds\":15,\"visibility\":10000,\"wind_speed\":0.6,\"wind_deg\":179,\"wind_gust\":2.23,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02n\"}],\"pop\":0},{\"dt\":1688104800,\"temp\":22.18,\"feels_like\":22.28,\"pressure\":1017,\"humidity\":70,\"dew_point\":16.44,\"uvi\":0,\"clouds\":16,\"visibility\":10000,\"wind_speed\":0.76,\"wind_deg\":274,\"wind_gust\":1.89,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02n\"}],\"pop\":0},{\"dt\":1688108400,\"temp\":21.75,\"feels_like\":21.83,\"pressure\":1016,\"humidity\":71,\"dew_point\":16.32,\"uvi\":0,\"clouds\":8,\"visibility\":10000,\"wind_speed\":0.76,\"wind_deg\":284,\"wind_gust\":1.69,\"weather\":[{\"id\":800,\"main\":\"Clear\",\"description\":\"clear sky\",\"icon\":\"01n\"}],\"pop\":0},{\"dt\":1688112000,\"temp\":21.3,\"feels_like\":21.39,\"pressure\":1017,\"humidity\":73,\"dew_point\":16.26,\"uvi\":0,\"clouds\":4,\"visibility\":10000,\"wind_speed\":1.75,\"wind_deg\":298,\"wind_gust\":2.72,\"weather\":[{\"id\":800,\"main\":\"Clear\",\"description\":\"clear sky\",\"icon\":\"01n\"}],\"pop\":0},{\"dt\":1688115600,\"temp\":20.72,\"feels_like\":20.81,\"pressure\":1017,\"humidity\":75,\"dew_point\":16.1,\"uvi\":0,\"clouds\":3,\"visibility\":10000,\"wind_speed\":1.44,\"wind_deg\":315,\"wind_gust\":2.23,\"weather\":[{\"id\":800,\"main\":\"Clear\",\"description\":\"clear sky\",\"icon\":\"01n\"}],\"pop\":0},{\"dt\":1688119200,\"temp\":20.52,\"feels_like\":20.59,\"pressure\":1017,\"humidity\":75,\"dew_point\":15.96,\"uvi\":0.09,\"clouds\":3,\"visibility\":10000,\"wind_speed\":1.35,\"wind_deg\":304,\"wind_gust\":2.12,\"weather\":[{\"id\":800,\"main\":\"Clear\",\"description\":\"clear sky\",\"icon\":\"01d\"}],\"pop\":0},{\"dt\":1688122800,\"temp\":21.51,\"feels_like\":21.52,\"pressure\":1018,\"humidity\":69,\"dew_point\":15.74,\"uvi\":0.48,\"clouds\":2,\"visibility\":10000,\"wind_speed\":1.02,\"wind_deg\":337,\"wind_gust\":1.33,\"weather\":[{\"id\":800,\"main\":\"Clear\",\"description\":\"clear sky\",\"icon\":\"01d\"}],\"pop\":0},{\"dt\":1688126400,\"temp\":23.18,\"feels_like\":23.17,\"pressure\":1018,\"humidity\":62,\"dew_point\":15.4,\"uvi\":1.42,\"clouds\":2,\"visibility\":10000,\"wind_speed\":0.31,\"wind_deg\":306,\"wind_gust\":0.51,\"weather\":[{\"id\":800,\"main\":\"Clear\",\"description\":\"clear sky\",\"icon\":\"01d\"}],\"pop\":0},{\"dt\":1688130000,\"temp\":24.93,\"feels_like\":24.86,\"pressure\":1018,\"humidity\":53,\"dew_point\":14.68,\"uvi\":3.01,\"clouds\":5,\"visibility\":10000,\"wind_speed\":1.38,\"wind_deg\":238,\"wind_gust\":1.88,\"weather\":[{\"id\":800,\"main\":\"Clear\",\"description\":\"clear sky\",\"icon\":\"01d\"}],\"pop\":0},{\"dt\":1688133600,\"temp\":26.51,\"feels_like\":26.51,\"pressure\":1018,\"humidity\":46,\"dew_point\":13.85,\"uvi\":5.03,\"clouds\":3,\"visibility\":10000,\"wind_speed\":1.79,\"wind_deg\":210,\"wind_gust\":2.28,\"weather\":[{\"id\":800,\"main\":\"Clear\",\"description\":\"clear sky\",\"icon\":\"01d\"}],\"pop\":0},{\"dt\":1688137200,\"temp\":27.76,\"feels_like\":27.52,\"pressure\":1018,\"humidity\":41,\"dew_point\":13.36,\"uvi\":7.05,\"clouds\":4,\"visibility\":10000,\"wind_speed\":2.42,\"wind_deg\":197,\"wind_gust\":2.65,\"weather\":[{\"id\":800,\"main\":\"Clear\",\"description\":\"clear sky\",\"icon\":\"01d\"}],\"pop\":0},{\"dt\":1688140800,\"temp\":28.58,\"feels_like\":28.04,\"pressure\":1018,\"humidity\":38,\"dew_point\":13.09,\"uvi\":8.6,\"clouds\":13,\"visibility\":10000,\"wind_speed\":3.08,\"wind_deg\":200,\"wind_gust\":2.72,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02d\"}],\"pop\":0},{\"dt\":1688144400,\"temp\":29.21,\"feels_like\":28.55,\"pressure\":1017,\"humidity\":37,\"dew_point\":12.96,\"uvi\":9.09,\"clouds\":16,\"visibility\":10000,\"wind_speed\":3.58,\"wind_deg\":187,\"wind_gust\":2.84,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02d\"}],\"pop\":0},{\"dt\":1688148000,\"temp\":29.67,\"feels_like\":28.92,\"pressure\":1017,\"humidity\":36,\"dew_point\":12.88,\"uvi\":8.45,\"clouds\":25,\"visibility\":10000,\"wind_speed\":3.78,\"wind_deg\":184,\"wind_gust\":3.03,\"weather\":[{\"id\":802,\"main\":\"Clouds\",\"description\":\"scattered clouds\",\"icon\":\"03d\"}],\"pop\":0},{\"dt\":1688151600,\"temp\":29.89,\"feels_like\":29.15,\"pressure\":1016,\"humidity\":36,\"dew_point\":13.01,\"uvi\":6.77,\"clouds\":32,\"visibility\":10000,\"wind_speed\":4.36,\"wind_deg\":176,\"wind_gust\":3.25,\"weather\":[{\"id\":802,\"main\":\"Clouds\",\"description\":\"scattered clouds\",\"icon\":\"03d\"}],\"pop\":0},{\"dt\":1688155200,\"temp\":29.65,\"feels_like\":29,\"pressure\":1016,\"humidity\":37,\"dew_point\":13.34,\"uvi\":4.73,\"clouds\":39,\"visibility\":10000,\"wind_speed\":4.88,\"wind_deg\":172,\"wind_gust\":3.52,\"weather\":[{\"id\":802,\"main\":\"Clouds\",\"description\":\"scattered clouds\",\"icon\":\"03d\"}],\"pop\":0},{\"dt\":1688158800,\"temp\":28.41,\"feels_like\":28.11,\"pressure\":1016,\"humidity\":41,\"dew_point\":13.94,\"uvi\":2.75,\"clouds\":58,\"visibility\":10000,\"wind_speed\":5.26,\"wind_deg\":175,\"wind_gust\":4.56,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04d\"}],\"pop\":0},{\"dt\":1688162400,\"temp\":26.76,\"feels_like\":26.98,\"pressure\":1017,\"humidity\":46,\"dew_point\":14.26,\"uvi\":1.23,\"clouds\":68,\"visibility\":10000,\"wind_speed\":5.28,\"wind_deg\":173,\"wind_gust\":5.95,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04d\"}],\"pop\":0},{\"dt\":1688166000,\"temp\":25.76,\"feels_like\":25.67,\"pressure\":1017,\"humidity\":49,\"dew_point\":14.22,\"uvi\":0.4,\"clouds\":75,\"visibility\":10000,\"wind_speed\":5.3,\"wind_deg\":165,\"wind_gust\":7.26,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04d\"}],\"pop\":0},{\"dt\":1688169600,\"temp\":24.88,\"feels_like\":24.78,\"pressure\":1017,\"humidity\":52,\"dew_point\":14.2,\"uvi\":0,\"clouds\":79,\"visibility\":10000,\"wind_speed\":4.73,\"wind_deg\":170,\"wind_gust\":7.67,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04d\"}],\"pop\":0},{\"dt\":1688173200,\"temp\":24.12,\"feels_like\":24.02,\"pressure\":1017,\"humidity\":55,\"dew_point\":14.4,\"uvi\":0,\"clouds\":96,\"visibility\":10000,\"wind_speed\":4.77,\"wind_deg\":163,\"wind_gust\":8.5,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04n\"}],\"pop\":0},{\"dt\":1688176800,\"temp\":23.6,\"feels_like\":23.5,\"pressure\":1017,\"humidity\":57,\"dew_point\":14.72,\"uvi\":0,\"clouds\":90,\"visibility\":10000,\"wind_speed\":4.09,\"wind_deg\":179,\"wind_gust\":8.29,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04n\"}],\"pop\":0},{\"dt\":1688180400,\"temp\":23.18,\"feels_like\":23.07,\"pressure\":1016,\"humidity\":58,\"dew_point\":14.68,\"uvi\":0,\"clouds\":83,\"visibility\":10000,\"wind_speed\":3.4,\"wind_deg\":181,\"wind_gust\":7.7,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04n\"}],\"pop\":0},{\"dt\":1688184000,\"temp\":22.73,\"feels_like\":22.63,\"pressure\":1016,\"humidity\":60,\"dew_point\":14.76,\"uvi\":0,\"clouds\":67,\"visibility\":10000,\"wind_speed\":3.1,\"wind_deg\":179,\"wind_gust\":6.96,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04n\"}],\"pop\":0},{\"dt\":1688187600,\"temp\":22.32,\"feels_like\":22.25,\"pressure\":1017,\"humidity\":63,\"dew_point\":14.88,\"uvi\":0,\"clouds\":60,\"visibility\":10000,\"wind_speed\":2.71,\"wind_deg\":195,\"wind_gust\":6.19,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04n\"}],\"pop\":0},{\"dt\":1688191200,\"temp\":21.9,\"feels_like\":21.79,\"pressure\":1016,\"humidity\":63,\"dew_point\":14.62,\"uvi\":0,\"clouds\":66,\"visibility\":10000,\"wind_speed\":2.45,\"wind_deg\":195,\"wind_gust\":5.43,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04n\"}],\"pop\":0},{\"dt\":1688194800,\"temp\":21.48,\"feels_like\":21.33,\"pressure\":1016,\"humidity\":63,\"dew_point\":14.14,\"uvi\":0,\"clouds\":50,\"visibility\":10000,\"wind_speed\":1.75,\"wind_deg\":204,\"wind_gust\":4.15,\"weather\":[{\"id\":802,\"main\":\"Clouds\",\"description\":\"scattered clouds\",\"icon\":\"03n\"}],\"pop\":0},{\"dt\":1688198400,\"temp\":21.06,\"feels_like\":20.89,\"pressure\":1016,\"humidity\":64,\"dew_point\":14,\"uvi\":0,\"clouds\":62,\"visibility\":10000,\"wind_speed\":1.61,\"wind_deg\":200,\"wind_gust\":3.32,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04n\"}],\"pop\":0},{\"dt\":1688202000,\"temp\":20.82,\"feels_like\":20.68,\"pressure\":1016,\"humidity\":66,\"dew_point\":14.14,\"uvi\":0,\"clouds\":74,\"visibility\":10000,\"wind_speed\":1.93,\"wind_deg\":213,\"wind_gust\":4.27,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04n\"}],\"pop\":0},{\"dt\":1688205600,\"temp\":20.78,\"feels_like\":20.66,\"pressure\":1016,\"humidity\":67,\"dew_point\":14.36,\"uvi\":0.05,\"clouds\":81,\"visibility\":10000,\"wind_speed\":1.62,\"wind_deg\":179,\"wind_gust\":3.69,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04d\"}],\"pop\":0},{\"dt\":1688209200,\"temp\":21.46,\"feels_like\":21.33,\"pressure\":1017,\"humidity\":64,\"dew_point\":14.34,\"uvi\":0.29,\"clouds\":84,\"visibility\":10000,\"wind_speed\":2.1,\"wind_deg\":222,\"wind_gust\":3.9,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04d\"}],\"pop\":0},{\"dt\":1688212800,\"temp\":22.06,\"feels_like\":21.89,\"pressure\":1017,\"humidity\":60,\"dew_point\":13.88,\"uvi\":0.86,\"clouds\":87,\"visibility\":10000,\"wind_speed\":1.87,\"wind_deg\":228,\"wind_gust\":3.09,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04d\"}],\"pop\":0}],\"daily\":[{\"dt\":1688054400,\"sunrise\":1688030828,\"sunset\":1688085088,\"moonrise\":1688071320,\"moonset\":1688018640,\"moon_phase\":0.36,\"summary\":\"Expect a day of partly cloudy with clear spells\",\"temp\":{\"day\":24.79,\"min\":18.4,\"max\":30.17,\"night\":23.56,\"eve\":29.52,\"morn\":19.45},\"feels_like\":{\"day\":24.73,\"night\":23.64,\"eve\":28.69,\"morn\":19.36},\"pressure\":1016,\"humidity\":54,\"dew_point\":14.86,\"wind_speed\":3.68,\"wind_deg\":322,\"wind_gust\":7.48,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02d\"}],\"clouds\":13,\"pop\":0.3,\"uvi\":8.76},{\"dt\":1688140800,\"sunrise\":1688117254,\"sunset\":1688171484,\"moonrise\":1688162220,\"moonset\":1688106840,\"moon_phase\":0.39,\"summary\":\"Expect a day of partly cloudy with clear spells\",\"temp\":{\"day\":28.58,\"min\":20.52,\"max\":29.89,\"night\":23.18,\"eve\":26.76,\"morn\":20.52},\"feels_like\":{\"day\":28.04,\"night\":23.07,\"eve\":26.98,\"morn\":20.59},\"pressure\":1018,\"humidity\":38,\"dew_point\":13.09,\"wind_speed\":5.3,\"wind_deg\":165,\"wind_gust\":8.5,\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02d\"}],\"clouds\":13,\"pop\":0,\"uvi\":9.09},{\"dt\":1688227200,\"sunrise\":1688203682,\"sunset\":1688257878,\"moonrise\":1688253120,\"moonset\":1688195580,\"moon_phase\":0.43,\"summary\":\"Expect a day of partly cloudy with rain\",\"temp\":{\"day\":22.41,\"min\":20.26,\"max\":23.47,\"night\":20.33,\"eve\":22.28,\"morn\":20.78},\"feels_like\":{\"day\":22.25,\"night\":20.85,\"eve\":22.31,\"morn\":20.66},\"pressure\":1016,\"humidity\":59,\"dew_point\":13.92,\"wind_speed\":4.28,\"wind_deg\":148,\"wind_gust\":8.86,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"clouds\":100,\"pop\":0.85,\"rain\":2.07,\"uvi\":3.32},{\"dt\":1688313600,\"sunrise\":1688290112,\"sunset\":1688344270,\"moonrise\":1688343720,\"moonset\":1688284980,\"moon_phase\":0.47,\"summary\":\"Expect a day of partly cloudy with rain\",\"temp\":{\"day\":24.4,\"min\":20.21,\"max\":27.56,\"night\":22.74,\"eve\":27.56,\"morn\":20.73},\"feels_like\":{\"day\":24.93,\"night\":23.45,\"eve\":28.82,\"morn\":21.37},\"pressure\":1011,\"humidity\":78,\"dew_point\":20.29,\"wind_speed\":3.46,\"wind_deg\":179,\"wind_gust\":8.04,\"weather\":[{\"id\":502,\"main\":\"Rain\",\"description\":\"heavy intensity rain\",\"icon\":\"10d\"}],\"clouds\":100,\"pop\":0.93,\"rain\":16.74,\"uvi\":3.85},{\"dt\":1688403600,\"sunrise\":1688376543,\"sunset\":1688430660,\"moonrise\":1688433780,\"moonset\":1688375160,\"moon_phase\":0.5,\"summary\":\"The day will start with rain through the late morning hours, transitioning to partly cloudy\",\"temp\":{\"day\":26.83,\"min\":21.81,\"max\":26.83,\"night\":23.25,\"eve\":24.91,\"morn\":21.81},\"feels_like\":{\"day\":27.87,\"night\":23.72,\"eve\":25.28,\"morn\":22.34},\"pressure\":1010,\"humidity\":60,\"dew_point\":18.44,\"wind_speed\":2.21,\"wind_deg\":184,\"wind_gust\":2.88,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"clouds\":100,\"pop\":0.64,\"rain\":0.65,\"uvi\":1.24},{\"dt\":1688490000,\"sunrise\":1688462975,\"sunset\":1688517048,\"moonrise\":1688523060,\"moonset\":1688466060,\"moon_phase\":0.55,\"summary\":\"Expect a day of partly cloudy with rain\",\"temp\":{\"day\":25.96,\"min\":21.59,\"max\":26.15,\"night\":21.59,\"eve\":22.04,\"morn\":23.06},\"feels_like\":{\"day\":25.96,\"night\":22.21,\"eve\":22.62,\"morn\":23.61},\"pressure\":1012,\"humidity\":67,\"dew_point\":19.35,\"wind_speed\":5.39,\"wind_deg\":107,\"wind_gust\":6.91,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"clouds\":95,\"pop\":0.88,\"rain\":2.34,\"uvi\":2},{\"dt\":1688576400,\"sunrise\":1688549409,\"sunset\":1688603434,\"moonrise\":1688611800,\"moonset\":1688557260,\"moon_phase\":0.59,\"summary\":\"There will be rain today\",\"temp\":{\"day\":23.12,\"min\":21.01,\"max\":23.82,\"night\":21.58,\"eve\":22.36,\"morn\":21.01},\"feels_like\":{\"day\":23.71,\"night\":22.14,\"eve\":22.87,\"morn\":21.62},\"pressure\":1010,\"humidity\":85,\"dew_point\":20.3,\"wind_speed\":4.81,\"wind_deg\":51,\"wind_gust\":7.4,\"weather\":[{\"id\":501,\"main\":\"Rain\",\"description\":\"moderate rain\",\"icon\":\"10d\"}],\"clouds\":100,\"pop\":0.98,\"rain\":6.93,\"uvi\":2},{\"dt\":1688662800,\"sunrise\":1688635845,\"sunset\":1688689819,\"moonrise\":1688700060,\"moonset\":1688648520,\"moon_phase\":0.62,\"summary\":\"There will be rain until morning, then partly cloudy\",\"temp\":{\"day\":29.61,\"min\":20.71,\"max\":29.61,\"night\":24.4,\"eve\":25.87,\"morn\":22.07},\"feels_like\":{\"day\":30.07,\"night\":24.96,\"eve\":26.29,\"morn\":22.53},\"pressure\":1010,\"humidity\":47,\"dew_point\":17.17,\"wind_speed\":3.45,\"wind_deg\":171,\"wind_gust\":5.25,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"clouds\":73,\"pop\":0.35,\"rain\":0.36,\"uvi\":2}]}")

        return@withContext parseWeatherApiResponse(json)
    }

    private suspend fun getJsonData(url: String): JSONObject = withContext(Dispatchers.IO) {
        val response = async { URL(url).readText() }
        JSONObject(response.await())
    }

    fun parseWeatherApiResponse(json: JSONObject): WeatherApiResponse {
        return with(json) {
            WeatherApiResponse(
                lat = getDouble("lat"),
                lon = getDouble("lon"),
                timezone = getString("timezone"),
                timezoneOffset = getInt("timezone_offset"),
                current = if (has("current")) parseCurrentWeather(getJSONObject("current")) else null,
                minutely = if (has("minutely")) parseMinutelyWeather(getJSONArray("minutely")) else null,
                hourly = if (has("hourly")) parseHourlyWeather(getJSONArray("hourly")) else null,
                daily = if (has("daily")) parseDailyWeather(getJSONArray("daily")) else null,
                alerts = if (has("alerts")) parseAlerts(getJSONArray("alerts")) else null
            )
        }
    }

    private fun parseCurrentWeather(json: JSONObject): CurrentWeather {
        return with(json) {
            CurrentWeather(
                dt = getLong("dt"),
                sunrise = getLong("sunrise"),
                sunset = getLong("sunset"),
                temp = getDouble("temp"),
                feelsLike = getDouble("feels_like"),
                pressure = getInt("pressure"),
                humidity = getInt("humidity"),
                dewPoint = getDouble("dew_point"),
                clouds = getInt("clouds"),
                uvi = getDouble("uvi"),
                visibility = getInt("visibility"),
                windSpeed = getDouble("wind_speed"),
                windGust = if (has("wind_gust")) getDouble("wind_gust") else null,
                windDeg = getInt("wind_deg"),
                rain = if (json.has("rain")) {
                    val rainObj = json.getJSONObject("rain")
                    if (rainObj.has("1h")) rainObj.getDouble("1h") else 0.0
                } else {
                    0.0
                },
                snow = if (json.has("snow")) {
                    val snowObj = json.getJSONObject("snow")
                    if (snowObj.has("1h")) snowObj.getDouble("1h") else 0.0
                } else {
                    0.0
                },
                weather = parseWeatherCondition(getJSONArray("weather").getJSONObject(0))
            )
        }
    }

    private fun parseMinutelyWeather(jsonArray: JSONArray): List<MinutelyWeather> {
        val minutelyWeatherList = mutableListOf<MinutelyWeather>()
        for (i in 0 until jsonArray.length()) {
            val json = jsonArray.getJSONObject(i)
            minutelyWeatherList.add(
                MinutelyWeather(
                    dt = json.getLong("dt"),
                    precipitation = json.getDouble("precipitation")
                )
            )
        }
        return minutelyWeatherList
    }

    private fun parseHourlyWeather(jsonArray: JSONArray): List<HourlyWeather> {
        val hourlyWeatherList = mutableListOf<HourlyWeather>()
        for (i in 0 until jsonArray.length()) {
            val json = jsonArray.getJSONObject(i)
            hourlyWeatherList.add(
                HourlyWeather(
                    dt = json.getLong("dt"),
                    temp = json.getDouble("temp"),
                    feelsLike = json.getDouble("feels_like"),
                    pressure = json.getInt("pressure"),
                    humidity = json.getInt("humidity"),
                    dewPoint = json.getDouble("dew_point"),
                    clouds = json.getInt("clouds"),
                    visibility = json.getInt("visibility"),
                    windSpeed = json.getDouble("wind_speed"),
                    windGust = if (json.has("wind_gust")) json.getDouble("wind_gust") else null,
                    windDeg = json.getInt("wind_deg"),
                    pop = json.getDouble("pop"),
                    rain = if (json.has("rain")) {
                        val rainObj = json.getJSONObject("rain")
                        if (rainObj.has("1h")) rainObj.getDouble("1h") else 0.0
                    } else {
                        0.0
                    },
                    snow = if (json.has("snow")) {
                        val snowObj = json.getJSONObject("snow")
                        if (snowObj.has("1h")) snowObj.getDouble("1h") else 0.0
                    } else {
                        0.0
                    },
                    weather = parseWeatherCondition(json.getJSONArray("weather").getJSONObject(0))
                )
            )
        }
        return hourlyWeatherList
    }

    private fun parseDailyWeather(jsonArray: JSONArray): List<DailyWeather> {
        val dailyWeatherList = mutableListOf<DailyWeather>()
        for (i in 0 until jsonArray.length()) {
            val json = jsonArray.getJSONObject(i)
            dailyWeatherList.add(
                DailyWeather(
                    dt = json.getLong("dt"),
                    sunrise = json.getLong("sunrise"),
                    sunset = json.getLong("sunset"),
                    moonrise = json.getLong("moonrise"),
                    moonset = json.getLong("moonset"),
                    moonPhase = json.getDouble("moon_phase"),
                    summary = json.getString("summary"),
                    temp = parseTemperature(json.getJSONObject("temp")),
                    feelsLike = parseFeelsLike(json.getJSONObject("feels_like")),
                    pressure = json.getInt("pressure"),
                    humidity = json.getInt("humidity"),
                    dewPoint = json.getDouble("dew_point"),
                    windSpeed = json.getDouble("wind_speed"),
                    windGust = if (json.has("wind_gust")) json.getDouble("wind_gust") else null,
                    windDeg = json.getInt("wind_deg"),
                    clouds = json.getInt("clouds"),
                    uvi = json.getDouble("uvi"),
                    pop = json.getDouble("pop"),
                    rain = if (json.has("rain")) json.getDouble("rain") else null,
                    snow = if (json.has("snow")) json.getDouble("snow") else null,
                    weather = parseWeatherCondition(json.getJSONArray("weather").getJSONObject(0))
                )
            )
        }
        return dailyWeatherList
    }

    private fun parseTemperature(json: JSONObject): Temperature {
        return with(json) {
            Temperature(
                morn = getDouble("morn"),
                day = getDouble("day"),
                eve = getDouble("eve"),
                night = getDouble("night"),
                min = getDouble("min"),
                max = getDouble("max")
            )
        }
    }

    private fun parseFeelsLike(json: JSONObject): FeelsLike {
        return with(json) {
            FeelsLike(
                morn = getDouble("morn"),
                day = getDouble("day"),
                eve = getDouble("eve"),
                night = getDouble("night"),
            )
        }
    }

    private fun parseWeatherCondition(json: JSONObject): WeatherCondition {
        return with(json) {
            WeatherCondition(
                id = getInt("id"),
                main = getString("main"),
                description = getString("description"),
                icon = getString("icon")
            )
        }
    }

    private fun parseAlerts(jsonArray: JSONArray): List<Alert> {
        val alertList = mutableListOf<Alert>()
        for (i in 0 until jsonArray.length()) {
            val json = jsonArray.getJSONObject(i)
            alertList.add(
                Alert(
                    senderName = json.getString("sender_name"),
                    event = json.getString("event"),
                    start = json.getLong("start"),
                    end = json.getLong("end"),
                    description = json.getString("description"),
                    tags = parseTags(json.getJSONArray("tags"))
                )
            )
        }
        return alertList
    }

    private fun parseTags(jsonArray: JSONArray): List<String> {
        val tags = mutableListOf<String>()
        for (i in 0 until jsonArray.length()) {
            tags.add(jsonArray.getString(i))
        }
        return tags
    }

// Utility functions to handle missing data

    private fun JSONObject.getDoubleOrDefault(key: String): Double {
        return if (has(key)) getDouble(key) else 0.0
    }

    private fun JSONObject.getIntOrDefault(key: String): Int {
        return if (has(key)) getInt(key) else 0
    }

    private fun JSONObject.getStringOrDefault(key: String): String {
        return if (has(key)) getString(key) else "N/A"
    }
}
